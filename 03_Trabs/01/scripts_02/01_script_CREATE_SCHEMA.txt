--#############
--# AMD GXX
--#############



--==============
-- DB connection
--==============
\set dataBase db_medknow
;
\set userName postgres
;
\connect :dataBase :userName
;
--==========================
--==========================


-- Deleting tables if exist
DROP TABLE IF EXISTS Visit CASCADE;
DROP TABLE IF EXISTS Prescription CASCADE;
DROP TABLE IF EXISTS Patient CASCADE;
DROP TABLE IF EXISTS Doctor CASCADE;
DROP TABLE IF EXISTS EyeCondition CASCADE;

-------------------------------
------- create table ----------
-------------------------------
CREATE TABLE EyeCondition (
    ConditionID INT PRIMARY KEY,
    ConditionName VARCHAR(30)
);

CREATE TABLE Doctor (
    DoctorID INT PRIMARY KEY,
    Name VARCHAR(50),
    Specialty VARCHAR(50)
);

CREATE TABLE Patient (
    PatientID INT PRIMARY KEY,
    Name VARCHAR(50),
    BirthDate DATE,
    ConditionID INT,
    DoctorID INT,
    FOREIGN KEY (ConditionID) REFERENCES EyeCondition(ConditionID),
    FOREIGN KEY (DoctorID) REFERENCES Doctor(DoctorID)
);

CREATE TABLE Prescription ( 
    PrescriptionID INT PRIMARY KEY,
    PatientID INT,
    DoctorID INT,
    Date DATE,
    Age VARCHAR(20),
    Astigmatic VARCHAR(3),
    TearRate VARCHAR(10),
    Lenses VARCHAR(10),
    FOREIGN KEY (PatientID) REFERENCES Patient(PatientID),
    FOREIGN KEY (DoctorID) REFERENCES Doctor(DoctorID)
);

CREATE TABLE Visit (
    VisitID INT PRIMARY KEY,
    PatientID INT,
    DoctorID INT,
    VisitDate TIMESTAMP,
    PrescriptionID INT,
    FOREIGN KEY (PatientID) REFERENCES Patient(PatientID),
    FOREIGN KEY (DoctorID) REFERENCES Doctor(DoctorID),
    FOREIGN KEY (PrescriptionID) REFERENCES Prescription(PrescriptionID)
);

-- \d EyeCondition;
