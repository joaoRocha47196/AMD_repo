--#############
--# AMD GXX
--#############



--==============
-- DB connection
--==============
\set dataBase db_medknow
;
\set userName postgres
;
\connect :dataBase :userName
;
--==========================
--==========================


-- Deleting Tables if They Exist
DROP TABLE IF EXISTS DIAGNOSIS_DISEASE CASCADE;
DROP TABLE IF EXISTS APPOINTMENT CASCADE;
DROP TABLE IF EXISTS DIAGNOSIS CASCADE;
DROP TABLE IF EXISTS PRESCRIPTION CASCADE;
DROP TABLE IF EXISTS DISEASE CASCADE;
DROP TABLE IF EXISTS DOCTOR CASCADE;
DROP TABLE IF EXISTS PATIENT CASCADE;

-------------------------------
------- create table ----------
-------------------------------

CREATE TABLE Patient (
    PatientID INT PRIMARY KEY,
    FirstName VARCHAR(50) NOT NULL,
    LastName VARCHAR(50) NOT NULL,
    BirthDate DATE NOT NULL,
    ContactInfo VARCHAR(50) NOT NULL
);

CREATE TABLE Doctor (
    DoctorID INT PRIMARY KEY,
    FirstName VARCHAR(50) NOT NULL,
    LastName VARCHAR(50) NOT NULL,
    Specialty VARCHAR(50) NOT NULL,
    ContactInfo VARCHAR(50) NOT NULL
);

CREATE TABLE Disease (
    DiseaseID INT PRIMARY KEY,
    DiseaseName VARCHAR(50) NOT NULL
);

CREATE TABLE Prescription (
    PrescriptionID INT PRIMARY KEY,
    LensHardness FLOAT,
    DatePrescribed DATE NOT NULL,
    PatientID INT,
    DoctorID INT,
    FOREIGN KEY (PatientID) REFERENCES Patient(PatientID),
    FOREIGN KEY (DoctorID) REFERENCES Doctor(DoctorID)
);

CREATE TABLE Diagnosis (
    DiagnosisID INT PRIMARY KEY,
    DateDiagnosed DATE NOT NULL,
    OcularAge VARCHAR(50) NOT NULL,
    TearRate FLOAT NOT NULL,
    PatientID INT,
    DoctorID INT,
    FOREIGN KEY (PatientID) REFERENCES Patient(PatientID),
    FOREIGN KEY (DoctorID) REFERENCES Doctor(DoctorID)
);

CREATE TABLE Appointment (
    AppointmentID INT PRIMARY KEY,
    VisitDate TIMESTAMP NOT NULL,
    PatientID INT,
    DoctorID INT,
    PrescriptionID INT,
    FOREIGN KEY (PatientID) REFERENCES Patient(PatientID),
    FOREIGN KEY (DoctorID) REFERENCES Doctor(DoctorID),
    FOREIGN KEY (PrescriptionID) REFERENCES Prescription(PrescriptionID)
);

CREATE TABLE Diagnosis_Disease ( 
    DiagnosisID INT,
    DiseaseID INT,
    PRIMARY KEY (DiagnosisID, DiseaseID),
    FOREIGN KEY (DiagnosisID) REFERENCES DIAGNOSIS(DiagnosisID),
    FOREIGN KEY (DiseaseID) REFERENCES DISEASE(DiseaseID)
);

-- \d Appointment;
